---
title: "Trade Statistics Report"
author: "Vanuatu National Statistics Office"
date: "`r format(Sys.Date(), '%d %b %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: '2'
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '2'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r preparation, include=FALSE}

# Load the required libraries
library(knitr) # Nice tables
library(kableExtra) # Extra nice tables
library(dplyr) # Manipulating data
library(openxlsx) # Reading and editing excel formatted files

# Load the general R functions
source("functions.R")

# Note the secure data path
secureDataFolder <- file.path("..", "data", "secure")

# Note the outputs folder
outputsFolder <- file.path("..", "outputs")
```

## Importing data files

```{r import raw data}

# Read in the raw trade data from secure folder of the repository 

# Note that spaces in column names have been automatically replaced with "."s
tradeStatsFile <- file.path(secureDataFolder, "SEC_PROC_ASY_RawDataAndReferenceTables_31-01-20.xlsx")
tradeStats <- read.xlsx(tradeStatsFile, sheet=1, skipEmptyRows=TRUE)

```

## Cleaning data files

```{r clean raw data}

# Remove the repeated header row from the trade statistics data
tradeStats <- tradeStats[tradeStats$Office != "Office", ]

# Remove duplicated rows from the trade statistics data
duplicatedRows <- duplicated(tradeStats) 
tradeStatsNoDup <- tradeStats[duplicatedRows == FALSE, ]

# Convert the CP4 to a factor
tradeStatsNoDup$CP4 <- as.factor(tradeStats$CP4)

# Convert the statistical value to numeric
tradeStatsNoDup$Stat..Value <- as.numeric(tradeStats$Stat..Value)

# Convert excel figures to dates
tradeStatsNoDup$Reg..Date <- as.Date(as.numeric(tradeStats$Reg..Date), origin="1899-12-30") # For numeric dates excel sets origin to December 30, 1899 (https://stackoverflow.com/questions/43230470/how-to-convert-excel-date-format-to-proper-date-in-r)

# Exclude banknotes from exports
tradeStatsNoBanknotes <- tradeStatsNoDup[tradeStatsNoDup$HS.Code != "49070010", ]

# Create subset for Export and Import commodities 
tradeStatsSubset <- tradeStatsNoBanknotes[tradeStatsNoBanknotes$Type %in% c("EX / 1","EX / 3", "IM / 4", "IM / 7", "PC / 4"), ]
tradeStatsCommodities <- tradeStatsSubset[tradeStatsSubset$CP4 %in% c(1000, 3071, 4000, 4071, 7100), ]

```

```{r examine missing data}
# Count the number of missing values in each column
numberMissing <- apply(tradeStatsCommodities, MARGIN=2,
                       FUN=function(columnValues){
                         return(sum(is.na(columnValues)))
                       })

# Convert the counts to a proportion
proportionMissing <- numberMissing / nrow(tradeStatsCommodities)

# Set the plotting margins
par(mar=c(10, 4, 4, 1))

# Plot the proportion missing in each column
barplot(proportionMissing[order(proportionMissing)], las=2, ylim=c(0,1),
        main="Amount missing values in each column",
        ylab="Proportion")
```

## Adapt data to create new columns

```{r adapt raw data to create new columns}

# Extract the 6, 4, and 2 digit HS codes into separate columns
tradeStatsCommodities$HS.Code_6 <- extractCodeSubset(tradeStatsCommodities$HS.Code, nDigits=6)
tradeStatsCommodities$HS.Code_4 <- extractCodeSubset(tradeStatsCommodities$HS.Code, nDigits=4)
tradeStatsCommodities$HS.Code_2 <- extractCodeSubset(tradeStatsCommodities$HS.Code, nDigits=2)

# Extract the 3 and 1 digit SITC codes into separate columns
tradeStatsCommodities$SITC_3 <- extractCodeSubset(tradeStatsCommodities$SITC, nDigits=3)
tradeStatsCommodities$SITC_1 <- extractCodeSubset(tradeStatsCommodities$SITC, nDigits=1)

# Create new columns for dates
tradeStatsCommodities$Year<- format(tradeStatsCommodities$Reg..Date, format= "%Y")
tradeStatsCommodities$Month<- format(tradeStatsCommodities$Reg..Date, format= "%B")
tradeStatsCommodities$Day<- format(tradeStatsCommodities$Reg..Date, format= "%d")
```

## Merge Mode of Transport classifcations with cleaned data

```{r merge Mode of Transport classifcations with cleaned dataset}

# Merge Mode of Transport classifications with cleaned data
tradeStatsFileMergeTransport <- file.path("..", "data", "open", "OPN_FINAL_ASY_ModeOfTransportClassifications_31-01-20.xlsx") 
modeOfTransport <- read.xlsx(tradeStatsFileMergeTransport, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommodities, modeOfTransport, by="Office", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="Office", column="Mode.of.Transport")
```

## Merge Harmonised System (HS) classifcations with cleaned data

```{r merge Harmonised System (HS) classifcations with cleaned dataset}

# Merge Harmonised System (HS) Code classifications with cleaned data
tradeStatsFileMergeHSCode <- file.path("..", "data", "open", "OPN_FINAL_ASY_HSCodeClassifications_31-01-20.xlsx") 
hsDescription <- read.xlsx(tradeStatsFileMergeHSCode, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, hsDescription, by="HS.Code_2", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="HS.Code_2", column="HS.Section")
```

## Merge Standard International Trade Classification (SITC) classifcations with cleaned data

```{r merge Standard International Trade Classification (SITC) classifcations with cleaned dataset}

# Merge Standard International Trade Classification (SITC) Code classifications with cleaned data
tradeStatsFileMergeSITCCode <- file.path("..", "data", "open", "OPN_FINAL_ASY_SITCCodeClassifications_31-01-20.xlsx") 
sitcDescription <- read.xlsx(tradeStatsFileMergeSITCCode, sheet=1, skipEmptyRows=TRUE)
colnames(sitcDescription)[2] <- "SITC_description"
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, sitcDescription, by="SITC_1", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="SITC_1", column="SITC_description")
```

## Merge Country Descriptions of Imports classifcations with cleaned data

```{r merge Country Descriptions of Imports classifcations with cleaned dataset}

# Merge Standard International Trade Classification (SITC) Code classifications with cleaned data
tradeStatsFileMergeCountryDesImports <- file.path("..", "data", "open", "OPN_FINAL_ASY_CountryDescriptionImportClassifications_31-01-20.xlsx")
countryDescriptionImports <- read.xlsx(tradeStatsFileMergeCountryDesImports, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, countryDescriptionImports, by="CO", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="CO", column="IMPORT.REG#")
```

## Merge Country Descriptions of Exports classifcations with cleaned data

```{r merge Country Descriptions of Imports classifcations with cleaned dataset}

# Merge Standard International Trade Classification (SITC) Code classifications with cleaned data
tradeStatsFileMergeCountryDesExports <- file.path("..", "data", "open", "OPN_FINAL_ASY_CountryDescriptionExportClassifications_31-01-20.xlsx") 
countryDescriptionExports <- read.xlsx(tradeStatsFileMergeCountryDesExports, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, countryDescriptionExports, by="CE/CD", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="CE/CD", column="EXPORT.REG#")
```

## Merge Principle Commodity classifcations with cleaned data

```{r merge Principle Commodity classifcations with cleaned dataset}

# Merge Principle Commodity Classifications of Exports and Imports with cleaned data
tradeStatsFileMergePrincipleCommdityClass <- file.path("..", "data", "open", "OPN_FINAL_ASY_PrincipleCommoditiesClassifications_31-01-20.xlsx") 
principleCommodityClassification <- read.xlsx(tradeStatsFileMergePrincipleCommdityClass, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, principleCommodityClassification, by="HS.Code", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="HS.Code", column="TAR_ALL")
```

## Merge Broad Economic Categories (BEC) with cleaned data

```{r merge Broad Economic Categories (BEC) with cleaned dataset}

# Merge Broad Economic Categories (BEC) classifications with cleaned data
tradeStatsFileMergeBECDescriptions <- file.path("..", "data", "open", "OPN_FINAL_ASY_BECClassifications_31-01-20.xlsx")
becDescriptions <- read.xlsx(tradeStatsFileMergeBECDescriptions, sheet=1, skipEmptyRows=TRUE)
tradeStatsCommoditiesMergedWithClassifications <- merge(tradeStatsCommoditiesMergedWithClassifications, becDescriptions, by="HS.Code_6", all.x=TRUE)

# Check if any observations are missing
searchForMissingObservations(tradeStatsCommoditiesMergedWithClassifications, by="HS.Code_6", column="BEC.Descriptions")
```

## Processed data set stored

```{r Processed data set stored}

# Processed data set stored
processedTradeStats <- tradeStatsCommoditiesMergedWithClassifications

```


## Table 1: Balance of Trade
```{r calculate balance of trade statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the balance of trade statistics - note that this remove a bit of redundancy
exports <- sum(processedTradeStats[processedTradeStats$CP4 == 1000, "Stat..Value"], na.rm=TRUE) # Added na.rm in case NAs introduced at later date
reExports <- sum(processedTradeStats[processedTradeStats$CP4 == 3071, "Stat..Value"], na.rm=TRUE)
totalExports <- exports + reExports
imports <- sum(processedTradeStats[processedTradeStats$CP4 %in% c(4000, 4071, 7100), "Stat..Value"], na.rm=TRUE)
balance <- totalExports - imports

# Insert values into table
tradeBalance <- data.frame("Export"=exports, "Re-Export"=reExports, "Total Export"=totalExports, "Imports CIF"=imports, "Trade Balance"=balance)

#prettyTable(tradeBalance)
```

```{r insert balance of trade statistics into final formatted table}

# Extremely helpful resource for openxlsx here: https://rdrr.io/cran/openxlsx/

# Note current year and month of data
date <- max(processedTradeStats$Reg..Date, na.rm=TRUE)
month <- format(date, "%B")
year <- format(date, "%Y")

# Note the excel workbook containing the final formmatted tables
finalWorkbookFileName <- file.path(outputsFolder, "SEC_FINAL_MAN_FinalTradeStatisticsTables_31-01-20_ORIGINAL - Copy.xlsx")

## Updating the Annual and Monthly sub tables
# Extract the balance of trade data and extract sub tables
balanceOfTradeSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="1_BOT", nColumns=7, startRow=5)

# Update the sub tables for the balance of trade data
balanceOfTradeSubTables <- updateSubTablesByTime(balanceOfTradeSubTables, month, year, tradeBalance/1000000)

## Editing the final formatted tables
if(is.null(balanceOfTradeSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="1_BOT", subTables=balanceOfTradeSubTables, nRowsInHeader=5)
}
```


## Table 2: Import by HS Code
```{r calculate import by HS Code statistics with base R, eval=FALSE, echo=FALSE}

# Define the CP4 codes need for table (Imports)
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "HS.Code_2"
columnCategories <- list(
  "Live animals: animal products"=c("01", "02", "03", "04", "05"),
  "Vegetable products"=c("06", "07", "08", "09", "10", "11", "12", "13", "14"),
  "Animal or vegetable oils & fats"=c("15"),
  "Prepared foodstuffs, beverages, spirits & tobacco"=c("16", "17", "18", "19", "20", "21", "22", "23", "24"),
  "Mineral products"=c("25", "26", "27"),
  "Chemicals and allied products"=c("28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38"),
  "Plastic, rubber & articles thereof"=c("39", "40"),
  "Raw hides, skins, leather articles & travel goods"=c("41", "42", "43"),
  "Wood, cork & articles thereof & plaiting material"=c("44", "45", "46"),
  "Wood pulp, paper & paperboard & articles thereof"=c("47", "48", "49"),
  "Textiles & textile articles"=c("50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63"),
  "Footwear, headgear, umbrellas & parts thereof"=c("64", "65", "66", "67"),
  "Articles of stone, plaster, cement, glass & ceremic products"=c("68", "69", "70"),
  "Pearls, precious & semi-precious stones & metals"=c("71"),
  "Base metals & articles thereof"=c("72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83"),
  "Machinery & mechanical & electrical appliances & parts thereof"=c("84", "85"),
  "Vehicles, aircraft & associated transport equipment"=c("86", "87", "88", "89"),
  "Photographic & optical, medical & surgical goods & clocks/watches & musical instruments"=c("90", "91", "92"),
  "Arms and ammunition, parts & accessories thereof"=c("93"),
  "Miscellaneous manufactured articles"=c("94", "95", "96"),
  "Works of art, collectors pieces & antiques"=c("97"),
  "Others"=c("98", "99")
)

# Build the table
importsByHS <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(importsByHS)

```


```{r insert Import by HS Code into final formatted table}
# Extract the  sub tables from the formatted excel table
importsByHSCodeSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="2_M", startRow=7, nColumns=25)

# Update the sub tables
importsByHSCodeSubTables <- updateSubTablesByTime(importsByHSCodeSubTables, month, year, importsByHS/1000000)

# Insert updated sub tables back into excel formatted table
if(is.null(importsByHSCodeSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="2_M", subTables=importsByHSCodeSubTables, nRowsInHeader=7)
}
```

## Table 3: Export by HS Code

```{r calculate export by HS Code statistics with base R, eval=FALSE, echo=FALSE}

# Define the CP4 codes need for table (Exports)
codesCP4 <- c(1000)

# Define the categories used for each column
categoryColumn <- "HS.Code_2"
columnCategories <- list(
  "Live animals: animal products"=c("01", "02", "03", "04", "05"),
  "Vegetable products"=c("06", "07", "08", "09", "10", "11", "12", "13", "14"),
  "Animal or vegetable oils & fats"=c("15"),
  "Prepared foodstuffs, beverages, spirits & tobacco"=c("16", "17", "18", "19", "20", "21", "22", "23", "24"),
  "Mineral products"=c("25", "26", "27"),
  "Chemicals and allied products"=c("28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38"),
  "Plastic, rubber & articles thereof"=c("39", "40"),
  "Raw hides, skins, leather articles & travel goods"=c("41", "42", "43"),
  "Wood, cork & articles thereof & plaiting material"=c("44", "45", "46"),
  "Wood pulp, paper & paperboard & articles thereof"=c("47", "48", "49"),
  "Textiles & textile articles"=c("50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63"),
  "Footwear, headgear, umbrellas & parts thereof"=c("64", "65", "66", "67"),
  "Articles of stone, plaster, cement, glass & ceremic products"=c("68", "69", "70"),
  "Pearls, precious & semi-precious stones & metals"=c("71"),
  "Base metals & articles thereof"=c("72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83"),
  "Machinery & mechanical & electrical appliances & parts thereof"=c("84", "85"),
  "Vehicles, aircraft & associated transport equipment"=c("86", "87", "88", "89"),
  "Photographic & optical, medical & surgical goods & clocks/watches & musical instruments"=c("90", "91", "92"),
  "Arms and ammunition, parts & accessories thereof"=c("93"),
  "Miscellaneous manufactured articles"=c("94", "95", "96"),
  "Works of art, collectors pieces & antiques"=c("97"),
  "Others"=c("98", "99")
)

# Build the table
exportsByHS <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(exportsByHS)

```

```{r insert Export by HS Code into final formatted table}
# Extract the  sub tables from the formatted excel table
exportsByHSCodeSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="3_DX", startRow=7, nColumns=25)

# Update the sub tables
exportsByHSCodeSubTables <- updateSubTablesByTime(exportsByHSCodeSubTables, month, year, exportsByHS/1000000)

# Insert updated sub tables back into excel formatted table
if(is.null(exportsByHSCodeSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="3_DX", subTables=exportsByHSCodeSubTables, nRowsInHeader=7)
}
```


## Table 4: Re-Export by HS Code

```{r calculate re-export by HS Code statistics with base R, eval=FALSE, echo=FALSE}

# Define the CP4 codes need for table
codesCP4 <- c(3071)

# Define the categories used for each column
categoryColumn <- "HS.Code_2"
columnCategories <- list(
  "Live animals: animal products"=c("01", "02", "03", "04", "05"),
  "Vegetable products"=c("06", "07", "08", "09", "10", "11", "12", "13", "14"),
  "Animal or vegetable oils & fats"=c("15"),
  "Prepared foodstuffs, beverages, spirits & tobacco"=c("16", "17", "18", "19", "20", "21", "22", "23", "24"),
  "Mineral products"=c("25", "26", "27"),
  "Chemicals and allied products"=c("28", "29", "30", "31", "32", "33", "34", "35", "36", "37", "38"),
  "Plastic, rubber & articles thereof"=c("39", "40"),
  "Raw hides, skins, leather articles & travel goods"=c("41", "42", "43"),
  "Wood, cork & articles thereof & plaiting material"=c("44", "45", "46"),
  "Wood pulp, paper & paperboard & articles thereof"=c("47", "48", "49"),
  "Textiles & textile articles"=c("50", "51", "52", "53", "54", "55", "56", "57", "58", "59", "60", "61", "62", "63"),
  "Footwear, headgear, umbrellas & parts thereof"=c("64", "65", "66", "67"),
  "Articles of stone, plaster, cement, glass & ceremic products"=c("68", "69", "70"),
  "Pearls, precious & semi-precious stones & metals"=c("71"),
  "Base metals & articles thereof"=c("72", "73", "74", "75", "76", "77", "78", "79", "80", "81", "82", "83"),
  "Machinery & mechanical & electrical appliances & parts thereof"=c("84", "85"),
  "Vehicles, aircraft & associated transport equipment"=c("86", "87", "88", "89"),
  "Photographic & optical, medical & surgical goods & clocks/watches & musical instruments"=c("90", "91", "92"),
  "Arms and ammunition, parts & accessories thereof"=c("93"),
  "Miscellaneous manufactured articles"=c("94", "95", "96"),
  "Works of art, collectors pieces & antiques"=c("97"),
  "Others"=c("98", "99")
)

# Build the table
reExportsByHS <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(reExportsByHS)

```

```{r insert Re-Export by HS Code into final formatted table}
# Extract the  sub tables from the formatted excel table
reExportsByHSCodeSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="4_ReX", startRow=7, nColumns=25)

# Update the sub tables
reExportsByHSCodeSubTables <- updateSubTablesByTime(reExportsByHSCodeSubTables, month, year, reExportsByHS/1000000)

# Insert updated sub tables back into excel formatted table
if(is.null(reExportsByHSCodeSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="4_ReX", subTables=reExportsByHSCodeSubTables, nRowsInHeader=7)
}
```


## Table 5: Total Exports by HS Code

```{r calculate total exports by HS Code statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the total exports
totalExportsByHS <- exportsByHS + reExportsByHS

#prettyTable(totalExportsByHS)

```

```{r insert Total Exports by HS Code into final formatted table}
# Extract the  sub tables from the formatted excel table
totalExportsByHSCodeSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="5_TX", startRow=7, nColumns=25)

# Update the sub tables
totalExportsByHSCodeSubTables <- updateSubTablesByTime(totalExportsByHSCodeSubTables, month, year, totalExportsByHS/1000000)

# Insert updated sub tables back into excel formatted table
if(is.null(totalExportsByHSCodeSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="5_TX", subTables=totalExportsByHSCodeSubTables, nRowsInHeader=7)
}
```

## Table 6: Principle Exports

```{r calculate principle exports statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the principle Exports 

# Define the CP4 codes need for table
codesCP4 <- c(1000)

# Define the categories used for each column
categoryColumn <- "Principle.Exports"
columnCategories <- list(
  "Alcoholic Drinks"=c("Alcoholic Drinks"),
  "Beef fresh, chilled, frozen and preserved"=c("Beef fresh, chilled, frozen and preserved"),
  "Cocoa"=c("Cocoa"),
  "Coconut Meal"=c("Coconut Meal"),
  "Coconut oil"=c("Coconut Oil"),
  "Coffee, all types"=c("Coffee, all types"),
  "Copra"=c("Copra"),
  "Cowhides"=c("Cowhides"),
  "Fish: Tuna"=c("Fish: Tuna"),
  "Kava"=c("Kava"),
  "Ornamental fish"=c("Ornamental fish"),
  "Shell buttons"=c("Shell buttons"),
  "Vanilla"=c("Vanilla"),
  "Wood and articles of wood; wood charcoal"=c("Wood and articles of wood; wood charcoal"),
  "Other products"=c("Other products")
)

# Build the table
totalPrincipleExports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# Calculate the principle Re-Exports 

# Define the CP4 codes need for table
codesCP4 <- c(3071)

# Define the categories used for each column
categoryColumn <- "Principle.Exports"
columnCategories <- list(
  "Alcoholic Drinks"=c("Alcoholic Drinks"),
  "Tobacco and cigarettes"=c("Tobacco and cigarettes"),
  "Fuel"=c("Fuel"),
  "Other products"=c("Other products")
)

# Build the table
totalPrincipleReExports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the final table
#prettyTable(totalPrincipleExportsandReExports)
```

```{r insert Principle Exports into final formatted table}
# Build a single vector storing the exports, re-exports and total
overallTotal <- sum(c(as.numeric(totalPrincipleExports[1, ]), as.numeric(totalPrincipleReExports[1, ])))
latestPrincipleExports <- c(NA, as.numeric(totalPrincipleExports[1, ]), NA, NA, as.numeric(totalPrincipleReExports[1, ]), NA, overallTotal)

# Extract the table from the formatted excel sheet
principleExportsTable <- read.xlsx(finalWorkbookFileName, sheet="6_PrinX", rows=5:31, skipEmptyRows=FALSE)

# Remove empty columns at end
principleExportsTable <- removeEmptyColumnsAtEnd(principleExportsTable)

# Add the latest month's statistics
principleExportsTable <- updateTableByCommodity(principleExportsTable, month, year, newStatistics=latestPrincipleExports / 1000000,
                                                numericColumns=2:ncol(principleExportsTable))

# Insert the updated table back into the formatted excel sheet
if(is.null(principleExportsTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="6_PrinX", table=principleExportsTable, year=year,
                                                tableNumber="6", tableName="PRINCIPLE EXPORTS", boldRows=c(6,22,24,29,31), nRowsInNotes=4,
                                                numericColumns=2:ncol(principleExportsTable))
}
```


## Table 7: Principle Imports

```{r calculate principle imports statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the principle Imports 

# Define the CP4 codes need for table
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "Principle.Imports"
columnCategories <- list(
  "Meat and edible offal of poultry"=c("Meat and edible offal of poultry"),
  "Fish and crustaceans, molluscs and other aquatic invertebrates"=c("Fish and crustaceans, molluscs and other aquatic invertebrates"),
  "Milk and Cream"=c("Milk and Cream"),
  "Rice"=c("Rice"),
  "Wheat or meslin flour"=c("Wheat or meslin flour"),
  "Other prepared or preserved meat, meat offal or blood"=c("Other prepared or preserved meat, meat offal or blood"),
  "Prepared or preserved fish"=c("Prepared or preserved fish"),
  "Sugar"=c("Sugar"),
  "Pasta, whether cooked or stuffed or otherwise prepared, such as spaghetti, macaroni, noodles, lasagne, gnocchi, ravioli, cannelloni; couscous"=c("Pasta, whether cooked or stuffed or otherwise prepared, such as spaghetti, macaroni, noodles, lasagne, gnocchi, ravioli, cannelloni; couscous"),
  "Prepared foods obtained by the swelling or roasting of cereals or cereal products eg corn flakes; cereals (excl maize) in grain or flakes"=c("Prepared foods obtained by the swelling or roasting of cereals or cereal products eg corn flakes; cereals (excl maize) in grain or flakes"),
  "Bread, pastry, cakes, biscuits and other bakers' wares"=c("Bread, pastry, cakes, biscuits and other bakers' wares"),
  "Non-alcoholic drinks including mineral water"=c("Non-alcoholic drinks including mineral water"),
  "Alcoholic drinks"=c("Alcoholic drinks"),
  "Preparations of a kind used in animal feeding"=c("Preparations of a kind used in animal feeding"),
  "Cigars, cheroots, cigarillos and cigarettes, of tobacco or of tobacco substitutes"=c("Cigars, cheroots, cigarillos and cigarettes, of tobacco or of tobacco substitutes"),
  "Portland cement, aluminous cement, slag cement, supersulphate cement and similar hydraulic cements"=c("Portland cement, aluminous cement, slag cement, supersulphate cement and similar hydraulic cements"),
  "Petroleum oils and oils obtained from bituminous minerals"=c("Petroleum oils and oils obtained from bituminous minerals"),
  "Petroleum gases and other gaseous hydrocarbons"=c("Petroleum gases and other gaseous hydrocarbons"),
  "Medicaments"=c("Medicaments"),
  "Perfumes, make-up preparations and preparations for the care of the skin (excl medicaments) and products for hair"=c("Perfumes, make-up preparations and preparations for the care of the skin (excl medicaments) and products for hair"),
  "Tubes, pipes and hoses, and fittings therefor (for example, joints, elbows, flanges), of plastics"=c("Tubes, pipes and hoses, and fittings therefor (for example, joints, elbows, flanges), of plastics"),
  "Articles for the conveyance or packing of goods; stoppers, lids, caps and other closures, of plastics"=c("Articles for the conveyance or packing of goods; stoppers, lids, caps and other closures, of plastics"),
  "New pneumatic tires, of rubber"=c("New pneumatic tires, of rubber"),
  "Wood sawn or chipped lengthwise, sliced or peeled, whether or not planed, sanded or end-jointed"=c("Wood sawn or chipped lengthwise, sliced or peeled, whether or not planed, sanded or end-jointed"),
  "Toilet paper and similar paper"=c("Toilet paper and similar paper"),
  "Printed books, brochures, leaflets and similar printed matter"=c("Printed books, brochures, leaflets and similar printed matter"),
  "Articles of apparel and clothing accessories"=c("Articles of apparel and clothing accessories"),
  "Other made up textile articles; sets; worn clothing and worn textile articles; rags"=c("Other made up textile articles; sets; worn clothing and worn textile articles; rags"),
  "Footwear, gaiters and the like; parts of such articles"=c("Footwear, gaiters and the like; parts of such articles"),
  "Iron and steel"=c("Iron and steel"),
  "Articles of iron or steel"=c("Articles of iron or steel"),
  "Aluminium and articles thereof"=c("Aluminium and articles thereof"),
  "Spark-ignition reciprocating or rotary internal combustion piston engines and compression-ignition internal combustion piston engines (diesel or semi-diesel engines)"=c("Spark-ignition reciprocating or rotary internal combustion piston engines and compression-ignition internal combustion piston engines (diesel or semi-diesel engines)"),
  "Refrigerators, freezers and other refrigerating or freezing equipment, electric or other; heat pumps other than air conditioning machines"=c("Refrigerators, freezers and other refrigerating or freezing equipment, electric or other; heat pumps other than air conditioning machines"),
  "Centrifuges, including centrifugal dryers; filtering or purifying machinery and apparatus, for liquids or gases"=c("Centrifuges, including centrifugal dryers; filtering or purifying machinery and apparatus, for liquids or gases"),
  "Self-propelled bulldozers, angledozers, graders, levellers, scrapers, mechanical shovels, excavators, shovel loaders, tamping machines and road rollers"=c("Self-propelled bulldozers, angledozers, graders, levellers, scrapers, mechanical shovels, excavators, shovel loaders, tamping machines and road rollers"),
  "Automatic data processing machines; magnetic or optical readers, machines for transcribing data onto data media in coded form and machines for processing such data"=c("Automatic data processing machines; magnetic or optical readers, machines for transcribing data onto data media in coded form and machines for processing such data"),
  "Electric generating sets and rotary converters"=c("Electric generating sets and rotary converters"),
  "Telephone sets, including telephones for cellular networks or for other wireless networks"=c("Telephone sets, including telephones for cellular networks or for other wireless networks"),
  "Insulated wire, cable and other insulated electric conductors, whether or not fitted with connectors; optical fibre cables, made up of individually sheathed fibres, whether or not assembled with electric conductors or fitted with connectors"=c("Insulated wire, cable and other insulated electric conductors, whether or not fitted with connectors; optical fibre cables, made up of individually sheathed fibres, whether or not assembled with electric conductors or fitted with connectors"),
  "Motor vehicles for the transport of passengers"=c("Motor vehicles for the transport of passengers"),
  "Motor vehicles for the transport of goods"=c("Motor vehicles for the transport of goods"),
  "Parts of aircraft"=c("Parts of aircraft"),
  "Yachts and other vessels for pleasure or sports; rowing boats and canoes"=c("Yachts and other vessels for pleasure or sports; rowing boats and canoes"),
  "Other furniture and parts thereof"=c("Other furniture and parts thereof"),
  "Personal and household effects"=c("Personal and household effects"),
  "Other Imports"=c("Other Imports")
)

# Build the table
totalPrincipleImports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(totalPrincipleImports)

```

```{r insert Principle Imports into final formatted table}
# Extract the table from the formatted excel sheet
principleImportsTable <- read.xlsx(finalWorkbookFileName, sheet="7_PrinM", rows=5:53, skipEmptyRows=FALSE)

# Remove empty columns at end
principleImportsTable <- removeEmptyColumnsAtEnd(principleImportsTable)

# Add the latest month's statistics
principleImportsTable <- updateTableByCommodity(principleImportsTable, month, year, newStatistics=totalPrincipleImports / 1000000, 
                                                numericColumns=2:ncol(principleImportsTable))

# Insert the updated table back into the formatted excel sheet
if(is.null(principleExportsTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="7_PrinM", table=principleImportsTable, year=year,
                                                tableNumber="7", tableName="PRINCIPLE IMPORTS", boldRows=c(53), nRowsInNotes=2,
                                                numericColumns=2:ncol(principleImportsTable))
}
```


## Table 8: Balance of Trade by Major Partner Countries
```{r calculate balance of trade by major partner countries statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the Exports by Major Partner Countries

# Define the CP4 codes need for table
codesCP4 <- c(1000, 3071)

# Define the categories used for each column
categoryColumn <- "EXPORT.COUNTRY"
columnCategories <- list(
  "Australia: Exports"=c("AUSTRALIA"),
  "China, People's Republic of: Exports"=c("CHINA, PEOPLES REPUBLIC OF"),
  "Fiji: Exports"=c("FIJI"),
  "France: Exports"=c("FRANCE"),
  "Hong Kong: Exports"=c("HONG KONG"),
  "India: Exports"=c("INDIA"),
  "Indonesia: Exports"=c("INDONESIA"),
  "Japan: Exports"=c("JAPAN"),
  "Korea, Republic Of: Exports"=c("KOREA, REPUBLIC OF"),
  "Malaysia: Exports"=c("MALAYSIA"),
  "Netherlands: Exports"=c("NETHERLANDS"),
  "New Caledonia: Exports"=c("NEW CALEDONIA"),
  "New Zealand: Exports"=c("NEW ZEALAND"),
  "Papua New Guinea: Exports"=c("PAPUA NEW GUINEA"),
  "Philippines: Exports"=c("PHILIPPINES"),
  "Singapore: Exports"=c("SINGAPORE"),
  "Solomon Islands: Exports"=c("SOLOMON ISLANDS"),
  "Thailand: Exports"=c("THAILAND"),
  "United Kingdom: Exports"=c("UNITED KINGDOM"),
  "United States of America: Exports"=c("UNITED STATES OF AMERICA")
)
countries <- unique(processedTradeStats[, "EXPORT.COUNTRY"])
columnCategories[["All Others: Exports"]] <- countries[countries %in% unlist(columnCategories) == FALSE]

# Build the table
totalPartnerCountryExports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# Calculate the Imports by Major Partner Countries

# Define the CP4 codes need for table
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "IMPORT.COUNTRY"
columnCategories <- list(
  "Australia: Imports"=c("AUSTRALIA"),
  "China, People's Republic of: Imports"=c("CHINA, PEOPLES REPUBLIC OF"),
  "Fiji: Imports"=c("FIJI"),
  "France: Imports"=c("FRANCE"),
  "Hong Kong: Imports"=c("HONG KONG"),
  "India: Imports"=c("INDIA"),
  "Indonesia: Imports"=c("INDONESIA"),
  "Japan: Imports"=c("JAPAN"),
  "Korea, Republic Of: Imports"=c("KOREA, REPUBLIC OF"),
  "Malaysia: Imports"=c("MALAYSIA"),
  "Netherlands: Imports"=c("NETHERLANDS"),
  "New Caledonia: Imports"=c("NEW CALEDONIA"),
  "New Zealand: Imports"=c("NEW ZEALAND"),
  "Papua New Guinea: Imports"=c("PAPUA NEW GUINEA"),
  "Philippines: Imports"=c("PHILIPPINES"),
  "Singapore: Imports"=c("SINGAPORE"),
  "Solomon Islands: Imports"=c("SOLOMON ISLANDS"),
  "Thailand: Imports"=c("THAILAND"),
  "United Kingdom: Imports"=c("UNITED KINGDOM"),
  "United States of America: Imports"=c("UNITED STATES OF AMERICA")
)
countries <- unique(processedTradeStats[, "IMPORT.COUNTRY"])
columnCategories[["All Others: Imports"]] <- countries[countries %in% unlist(columnCategories) == FALSE]

# Build the table
totalPartnerCountryImports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# Calculate the Balance of Trade by Major Partner Countries

balanceOfTradeByMajorPartnerCountries <- totalPartnerCountryExports - totalPartnerCountryImports
colnames(balanceOfTradeByMajorPartnerCountries) <- sapply(colnames(balanceOfTradeByMajorPartnerCountries),
                                                          FUN=function(colName){
                                                            return(strsplit(colName, split=":")[[1]][1])
                                                          })
#prettyTable(balanceOfTradeByMajorPartnerCountries)

```

```{r insert balance of trade by major partner countries into final formatted table}
# Build a single vector aligned with the format of table 8: Exports, Imports, Balance for each major partner country
majorPartnerCountryStatistics <- c()
majorPartnerCountryStatistics[seq(from=1, by=3, length.out=length(totalPartnerCountryExports))] <- as.numeric(totalPartnerCountryExports)
majorPartnerCountryStatistics[seq(from=2, by=3, length.out=length(totalPartnerCountryImports))] <- as.numeric(totalPartnerCountryImports)
majorPartnerCountryStatistics[seq(from=3, by=3, length.out=length(balanceOfTradeByMajorPartnerCountries))] <- as.numeric(balanceOfTradeByMajorPartnerCountries)

# Extract the table from the formatted excel sheet
balanceOfTradeMajorTable <- read.xlsx(finalWorkbookFileName, sheet="8_BOT_PC", rows=5:71, skipEmptyRows=FALSE)

# Remove empty columns at end
balanceOfTradeMajorTable <- removeEmptyColumnsAtEnd(balanceOfTradeMajorTable)

# Add the latest month's statistics
balanceOfTradeMajorTable <- updateTableByCommodity(balanceOfTradeMajorTable, month, year, 
                                                   newStatistics=majorPartnerCountryStatistics / 1000000, 
                                                   numericColumns=3:ncol(balanceOfTradeMajorTable))
 
# Insert the updated table back into the formatted excel sheet
if(is.null(balanceOfTradeMajorTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="8_BOT_PC", table=balanceOfTradeMajorTable, year=year, 
                                                tableNumber="8", tableName="BALANCE OF TRADE BY MAJOR PARTNER COUNTRIES", 
                                                boldRows=c(69, 70, 71), nRowsInNotes=2,
                                                numericColumns=3:ncol(balanceOfTradeMajorTable))
}
```


## Table 9: Balance of Trade by Region
```{r calculate balance of trade by region statistics with base R, eval=FALSE, echo=FALSE}

# Calculate the Exports by Region

# Define the CP4 codes need for table
codesCP4 <- c(1000, 3071)

# Define the categories used for each column
categoryColumn <- "EXPORT.REGION"
columnCategories <- list(
  "Africa: Exports"=c("AFRICA"),
  "The Americas: Exports"=c("AMERICAS"),
  "Asia: Exports"=c("ASIA"),
  "Europe: Exports"=c("EUROPE"),
  "Oceania: Exports"=c("OCEANIA"),
  "Various: Exports"=c("VARIOUS")
)

# Build the table
totalPartnerRegionExports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)


# Calculate the Imports by Region

# Define the CP4 codes need for table
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "IMPORT.REGION"
columnCategories <- list(
  "Africa: Imports"=c("AFRICA"),
  "The Americas: Imports"=c("AMERICAS"),
  "Asia: Imports"=c("ASIA"),
  "Europe: Imports"=c("EUROPE"),
  "Oceania: Imports"=c("OCEANIA"),
  "Various: Imports"=c("VARIOUS")
)

# Build the table
totalPartnerRegionImports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# Calculate the Balance of Trade by Region

balanceOfTradeByRegion <- totalPartnerRegionExports - totalPartnerRegionImports
colnames(balanceOfTradeByRegion) <- sapply(colnames(balanceOfTradeByRegion),
                                           FUN=function(colName){
                                             return(strsplit(colName, split=":")[[1]][1])
                                           })

# Calculate the Balance of Trade for the Pacific Islands
pictsExports <- totalPartnerRegionExports["Oceania: Exports"] - totalPartnerCountryExports["New Zealand: Exports"] - totalPartnerCountryExports["Australia: Exports"]
pictsImports<- totalPartnerRegionImports["Oceania: Imports"] - totalPartnerCountryImports["New Zealand: Imports"] - totalPartnerCountryImports["Australia: Imports"]
pictsBalance<- balanceOfTradeByRegion["Oceania"] - balanceOfTradeByMajorPartnerCountries["Australia"] - balanceOfTradeByMajorPartnerCountries["New Zealand"]
```

```{r insert balance of trade by Region into final formatted table}
# Build a single vector aligned with the format of table 8: Exports, Imports, Balance for each region
majorRegionStatistics <- c()
majorRegionStatistics[seq(from=1, by=3, length.out=length(totalPartnerRegionExports))] <- as.numeric(totalPartnerRegionExports)
majorRegionStatistics[seq(from=2, by=3, length.out=length(totalPartnerRegionImports))] <- as.numeric(totalPartnerRegionImports)
majorRegionStatistics[seq(from=3, by=3, length.out=length(balanceOfTradeByRegion))] <- as.numeric(balanceOfTradeByRegion)

# Add in pacific islands statistics
majorRegionStatistics <- c(majorRegionStatistics, NA, as.numeric(pictsExports), as.numeric(pictsImports), as.numeric(pictsBalance))

# Extract the table from the formatted excel sheet
balanceOfTradeRegionsTable <- read.xlsx(finalWorkbookFileName, sheet="9_Trade_Reg", rows=5:30, skipEmptyRows=FALSE)

# Remove empty columns at end
balanceOfTradeRegionsTable <- removeEmptyColumnsAtEnd(balanceOfTradeRegionsTable)

# Add the latest month's statistics
balanceOfTradeRegionsTable <- updateTableByCommodity(balanceOfTradeRegionsTable, month, year, 
                                                     newStatistics=majorRegionStatistics / 1000000, 
                                                     numericColumns=3:ncol(balanceOfTradeRegionsTable))
 
# Insert the updated table back into the formatted excel sheet
if(is.null(balanceOfTradeRegionsTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="9_Trade_Reg", table=balanceOfTradeRegionsTable, year=year,
                                                tableNumber="9", tableName="TRADE BY REGION", 
                                                boldRows=c(24, 25, 26), nRowsInNotes=2,
                                                numericColumns=3:ncol(balanceOfTradeRegionsTable))
}

```


## Table 10: Trade by Mode of Transport 
```{r calculate trade by mode of transport statistics with base R, eval=FALSE, echo=FALSE}

# Calculate Export Trade by Mode of Transport

# Define the CP4 codes need for table
codesCP4 <- c(1000, 3071)

# Define the categories used for each column
categoryColumn <- "Mode.of.Transport"
columnCategories <- list(
  "Air: Exports"=c("AIR"),
  "Water: Exports"=c("SEA"),
  "Land: Exports"=c("LAND"),
  "Postal: Exports"=c("POSTAGE"),
  "Other: Exports"=c("OTHER")
)

# Build the table
totalTransportExports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(totalTransportExports)


# Calculate Import Trade by Mode of Transport

# Define the CP4 codes need for table
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "Mode.of.Transport"
columnCategories <- list(
  "Air: Imports"=c("AIR"),
  "Water: Imports"=c("SEA"),
  "Land: Imports"=c("LAND"),
  "Postal: Imports"=c("POSTAGE"),
  "Other: Imports"=c("OTHER")
)

# Build the table
totalTransportImports <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(totalTransportImports)

# Calculate Trade by Mode of Transport
tradebyModeOfTransport<- totalTransportExports + totalTransportImports
#prettyTable(tradebyModeOfTransport)

```

```{r insert balance of trade by Region into final formatted table}
tradeByModeOfTransport <- data.frame(rbind(as.numeric(totalTransportExports), as.numeric(totalTransportImports)))
colnames(tradeByModeOfTransport) <- c(unlist(columnCategories), "Total")

# Extract the  sub tables from the formatted excel table
tradeByModeOfTransportSubTables <- extractSubTablesFromFormattedTableByTime(finalWorkbookFileName, sheet="10_Trade_Trspt", startRow=8, nColumns=8, numericColumns=3:8)

# Update the sub tables
tradeByModeOfTransportSubTables <- updateSubTablesByTime(tradeByModeOfTransportSubTables, month, year, tradeByModeOfTransport/1000000, monthColumn="Year")

# Insert updated sub tables back into excel formatted table
if(is.null(tradeByModeOfTransportSubTables) == FALSE){
  insertUpdatedSubTablesAsFormattedTable(finalWorkbookFileName, sheet="10_Trade_Trspt", subTables=tradeByModeOfTransportSubTables, nRowsInHeader=8)
}
```

## Table 11: Trade by Trade Agreement
```{r calculate trade by mode of transport statistics with base R, eval=FALSE, echo=FALSE}

# Get the trade stats for the 
tradeStatsForMSG <- processedTradeStats[is.na(processedTradeStats$PRF) == FALSE & processedTradeStats$PRF == "MSG", ]

# Aggregate the statistical value column by country and SITC (note import and export countries always appear to be equal)
msgLatestStats <- aggregate(tradeStatsForMSG$Stat..Value, by=list(tradeStatsForMSG$SITC_1, 
                                                                  tradeStatsForMSG$IMPORT.COUNTRY),
                            FUN=sum, na.rm=TRUE)
colnames(msgLatestStats) <- c("SITC_1", "COUNTRY", "Stat..Value")

# Create a table to store the data in
templateMSGTable <- data.frame(matrix(nrow=10, ncol=length(unique(msgLatestStats$COUNTRY))))
rownames(templateMSGTable) <- 0:9
colnames(templateMSGTable) <- sort(unique(msgLatestStats$COUNTRY))

# Fill in the values from this month
for(row in seq_len(nrow(msgLatestStats))){
  templateMSGTable[msgLatestStats[row, "SITC_1"], msgLatestStats[row, "COUNTRY"]] <- msgLatestStats[row, "Stat..Value"]
}

# Add total column
templateMSGTable$Total <- rowSums(templateMSGTable, na.rm=TRUE)
templateMSGTable[templateMSGTable == 0] <- NA
```

```{r insert balance of trade by Region into final formatted table}
finalWorkbook <- openxlsx::loadWorkbook(finalWorkbookFileName)
openxlsx::writeData(finalWorkbook, sheet="11_TradeAg", startCol=2, startRow=3, x=templateMSGTable, colNames=FALSE)
openxlsx::saveWorkbook(finalWorkbook, file=finalWorkbookFileName, overwrite=TRUE)
```

## Table 12: Exports by SITC 
```{r calculate trade by mode of transport statistics with base R, eval=FALSE, echo=FALSE}

# Calculate Exports by SITC 

# Define the CP4 codes need for table
codesCP4 <- c(1000, 3071)

# Define the categories used for each column
categoryColumn <- "SITC_1"
columnCategories <- list(
  "Food and live animals"=c("0"),
  "Beverages and tobacco"=c("1"),
  "Crude materials, inedible, except fuels"=c("2"),
  "Mineral fuels, lubricants and related materials"=c("3"),
  "Animal and vegetable oils, fats and waxes"=c("4"),
  "Chemicals and related products, not elsewhere specified"=c("5"),
  "Manufactured goods classified chiefly by material"=c("6"),
  "Machinery and transport equipment"=c("7"),
  "Miscellaneous manufactured goods"=c("8"),
  "Commodities and transactions not classified elsewhere in SITC"=c("9")
)

# Build the table
totalExportsbySITC <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(totalExportsbySITC)
```

```{r insert balance of trade by Region into final formatted table}
# Extract the table from the formatted excel sheet
totalExportsbySITCTable <- read.xlsx(finalWorkbookFileName, sheet="12_X_SITC", rows=5:16, skipEmptyRows=FALSE)

# Remove empty columns at end
totalExportsbySITCTable <- removeEmptyColumnsAtEnd(totalExportsbySITCTable)

# Add the latest month's statistics
totalExportsbySITCTable <- updateTableByCommodity(totalExportsbySITCTable, month, year, 
                                                  newStatistics=totalExportsbySITC / 1000000, 
                                                  numericColumns=3:ncol(totalExportsbySITCTable))

# Insert the updated table back into the formatted excel sheet
if(is.null(totalExportsbySITCTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="12_X_SITC", table=totalExportsbySITCTable, year=year,
                                                tableNumber="12", tableName="EXPORTS BY SITC", boldRows=c(16), nRowsInNotes=3,
                                                numericColumns=3:ncol(totalExportsbySITCTable))
}
```

## Table 13: Imports by SITC
```{r calculate trade by mode of transport statistics with base R, eval=FALSE, echo=FALSE}

# Calculate Exports by SITC 

# Define the CP4 codes need for table
codesCP4 <- c(4000, 4071, 7100)

# Define the categories used for each column
categoryColumn <- "SITC_1"
columnCategories <- list(
  "Food and live animals"=c("0"),
  "Beverages and tobacco"=c("1"),
  "Crude materials, inedible, except fuels"=c("2"),
  "Mineral fuels, lubricants and related materials"=c("3"),
  "Animal and vegetable oils, fats and waxes"=c("4"),
  "Chemicals and related products, not elsewhere specified"=c("5"),
  "Manufactured goods classified chiefly by material"=c("6"),
  "Machinery and transport equipment"=c("7"),
  "Miscellaneous manufactured goods"=c("8"),
  "Commodities and transactions not classified elsewhere in SITC"=c("9")
)

# Build the table
totalImportsbySITC <- buildRawSummaryTable(processedTradeStats, codesCP4, categoryColumn, columnCategories)

# View the table
#prettyTable(totalImportsbySITC)

```

```{r insert balance of trade by Region into final formatted table}
# Extract the table from the formatted excel sheet
totalImportsbySITCTable <- read.xlsx(finalWorkbookFileName, sheet="13_M_SITC", rows=5:16, skipEmptyRows=FALSE)

# Remove empty columns at end
totalImportsbySITCTable <- removeEmptyColumnsAtEnd(totalImportsbySITCTable)

# Add the latest month's statistics
totalImportsbySITCTable <- updateTableByCommodity(totalImportsbySITCTable, month, year, 
                                                  newStatistics=totalImportsbySITC / 1000000, 
                                                  numericColumns=3:ncol(totalImportsbySITCTable))

# Insert the updated table back into the formatted excel sheet
if(is.null(totalImportsbySITCTable) == FALSE){
  insertUpdatedTableByCommodityAsFormattedTable(finalWorkbookFileName, sheet="13_M_SITC", table=totalImportsbySITCTable, year=year,
                                                tableNumber="13", tableName="IMPORTS BY SITC", boldRows=c(16), nRowsInNotes=2,
                                                numericColumns=3:ncol(totalImportsbySITCTable))
}
```

##  Retained Imports Classified by Broad Economic Categories		
```{r calculate trade by mode of transport statistics with base R, eval=FALSE, echo=FALSE}

# Calculate Export Trade by Mode of Transport



```

```{r insert balance of trade by Region into final formatted table}


```